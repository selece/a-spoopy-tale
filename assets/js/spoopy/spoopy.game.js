"use strict";require.config({paths:{jquery:"../jquery.min",underscore:"../underscore.min",pubsub:"../pubsub"}}),define(["jquery","underscore","pubsub","spoopy.rooms","spoopy.items","spoopy.player"],(e,n,o,r,t,s)=>{this.player=new s,e(document).ready(()=>{c(this.player),n.mapObject(r.rooms,n=>e("#nav ul").append(i(n)))});let i=n=>e("<li>").html(e("<a>",{text:n.name,href:"#",click:()=>o.publish("ENGINE_NAV_CLICK",n.name)})),l=(e,o)=>{let r;for(console.log("engine_get_room():",o);void 0===r;){let t=n.filter(e,function(e){return!this._.contains(this.exc,e)},{exc:o,_:n});if(!(t.length>0)){console.error("engine_get_room(): no valid rooms");break}r=n.sample(t)||void 0}return console.log("engine_get_room():",n.contains(o,r),r),r},g=(e,o,r,t)=>{let s=[],i=[e];for(let e in n.range(o)){let e=l(r,n.union(i,t));void 0!==e?(s.push(e),i.push(e),console.log("engine_generate_room_connections():",e,i)):console.error("engine_generate_room_connections(): undefined from new_conn generator.")}return{connections:s,exclusions:n.union(t,i)}};(e=>{let o=n.range(50),r={},t=g(0,n(4),o,[]);r[0]=t.connections,((e,o)=>{console.log("engine_generate_missing_edges(): looking at",e[o]);for(let r in e[o]){let t=e[o][r];console.log("engine_generate_missing_edges(): building missing edges for",t),n.has(e,t)||(e[t]=[]),n.find(e[t],o)?console.log("engine_generate_missing_edges(): edge already exists"):e[t].push(o)}})(r,0),console.log("*** GEN 2 ***");let s=n.chain(r).filter(function(e){return e.toString()!==this.start.toString()},{start:0}).first().value();for(let e in s)console.log("generating children for:",s[e]),console.log(g(s[e],n.random(2,4),o,t.exclusions))})(r.rooms);let c=n=>{e("#header h1").text(n.loc),e("#content p").text(r.get_description(n.loc))};o.subscribe("ENGINE_NAV_CLICK",(e,n)=>c(this.player))});