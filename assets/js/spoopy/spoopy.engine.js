define("spoopy.engine",["underscore","jquery","pubsub"],(n,e,i)=>{"use strict";function t(n){if(!(this instanceof t))throw new TypeError("Engine constructor cannot be called as function!");this.adjacency={},this.exclusions=[],this.available=n}return t.DEFAULT_STARTING_LOCATION="Foyer",t.prototype={constructor:t,build_room_nav_link:function(n){return e("<li>").html(e("<a>",{text:n,href:"#",click:function(){i.publish("ENGINE_NAV_CLICK",n)}}))},engine_get_room:function(){let e=n.filter(this.available,function(e){return!n.contains(this.exc,e)},{exc:this.exclusions});if(e.length>0){let i=n.sample(e);return console.log("engine_get_room():",i),i}},engine_update_exclusions:function(e){console.log("pre-upd exc:",this.exclusions),this.exclusions=n.chain(this.exclusions).union(e).unique().value(),console.log("updated exc:",this.exclusions)},engine_update_adjacency:function(e,i){void 0===this.adjacency[e]&&(this.adjacency[e]=[]),void 0===this.adjacency[i]&&(this.adjacency[i]=[]),this.adjacency[e].push(i),this.adjacency[i].push(e),this.adjacency[e]=n.unique(this.adjacency[e]),this.adjacency[i]=n.unique(this.adjacency[i])},engine_get_branches:function(e){return n.chain(this.adjacency).filter(function(n){return n.toString()!==this.t.toString()},{t:e}).first().value()},engine_build_at:function(e,i){this.engine_update_exclusions([e]);for(let t in n.range(n.isFunction(i)?i():i)){let n=this.engine_get_room();if(void 0===n){console.log("engine_build_at(): error, no available rooms");break}this.engine_update_adjacency(e,n),this.engine_update_exclusions([n])}},engine_build_map:function(e){this.engine_build_at(e.start.loc,n.random(e.start.min_branches,e.start.max_branches)),console.log("engine_build_map(): root complete ->",this.adjacency,this.exclusions),console.log("engine_build_map(): branches @",e.start.loc,this.engine_get_branches(e.start.loc));let i=this.engine_get_branches(e.start.loc);for(let t in n.range(e.gens)){console.log("engine_build_map(): building generation",t);for(let n in i)console.log("engine_build_map(): building branch @",i[n]),this.engine_build_at(i[n],e.gens_fn())}console.log("engine_build_map(): done branches ->",this.adjacency,this.exclusions)}},t});