"use strict";require.config({paths:{jquery:"../jquery.min",underscore:"../underscore.min",pubsub:"../pubsub"}}),define(["jquery","underscore","pubsub","spoopy.rooms","spoopy.items","spoopy.player"],(e,o,n,t,r,i)=>{this.player=new i,e(document).ready(()=>{p(this.player),o.mapObject(t.rooms,o=>e("#nav ul").append(u(o)))});let u=o=>e("<li>").html(e("<a>",{text:o.name,href:"#",click:()=>n.publish("ENGINE_NAV_CLICK",o.name)})),s=(e,n)=>{console.log("engine_get_room(): exc ->",n);let t=o.filter(e,function(e){return!this._.contains(this.exc,e)},{exc:n,_:o});if(t.length>0){let e=o.sample(t);return console.log("engine_get_room(): got ",e),e}console.error("engine_get_room(): no valid rooms")},l=(e,n)=>o.chain(e).union(n).unique().value(),a=(e,n,t)=>(void 0===e[n]&&(e[n]=[]),void 0===e[t]&&(e[t]=[]),e[n].push(t),e[t].push(n),e[n]=o.unique(e[n]),e[t]=o.unique(e[t]),e),c=(e,n)=>o.chain(n).filter(function(e){return e.toString()!==this.trunk.toString()},{trunk:e}).first().value(),d=(e,n,t,r,i)=>{for(let u in o.range(o.isFunction(n)?n():n)){let o=s(t,r);if(void 0===o){console.error("engine_build_at(): could not get available room for pick");break}i=a(i,e,o),r=l(r,[o])}return{updated_adjacency:i,updated_exclusions:r}};(e=>{let n=o.range(15),t={},r=[];r=l(r,[0]);let i=d(0,o.random(3,6),n,r,t);t=i.updated_adjacency,r=i.updated_exclusions,console.log("adj:",t," exc:",r);let u=c(0,t);console.log("branches -> trunk @ ",0,u);for(let e in u)d(u[e],o.random(1,2),n,r,t),console.log("upds -> ",i.updated_adjacency,i.updated_exclusions),t=i.updated_adjacency,r=i.updated_exclusions,console.log("branch @ ",u[e],", adj:",t," exc:",r)})(t.rooms);let p=o=>{e("#header h1").text(o.loc),e("#content p").text(t.get_description(o.loc))};n.subscribe("ENGINE_NAV_CLICK",(e,o)=>p(this.player))});